upstream puma {
   # reaching the service that discovers the Rails' pod
   server rails-svc:4000;
}

server {
   listen 8080;
   root /usr/share/nginx/html;
   try_files $uri @puma;
   access_log off;
   gzip_static on; # to serve pre-gzipped version
   expires max;
   add_header Cache-Control public;

   add_header Last-Modified "";
   add_header ETag "";

   location @puma {
      proxy_set_header    X-Real-IP       $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header    Host            $http_host;
      proxy_pass_header   Set-Cookie;
      proxy_redirect      off;
      proxy_pass          http://puma;
   }
  
   error_page 500 502 503 504 /500.html;
   location = /500.html {
      root /usr/share/nginx/html;
   }
}
